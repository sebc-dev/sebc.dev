# Architecture

**Analysis Date:** 2026-02-09

## Pattern Overview

**Overall:** Static Site Generator with Content-Driven i18n

**Key Characteristics:**
- File-based routing with locale prefixing (Astro 5 i18n)
- Content collection system for MDX articles with frontmatter schema
- Tailwind CSS v4 via Vite plugin (not Astro integration)
- Static output to Cloudflare Pages
- Server-side rendering at build time, no runtime code execution

## Layers

**Presentation Layer:**
- Purpose: Render HTML pages and components
- Location: `src/pages/`, `src/layouts/`, `src/components/`
- Contains: Astro page templates, layout wrappers, UI components
- Depends on: Content collection (via `astro:content`), Tailwind styles
- Used by: Browser/HTTP client

**Content Layer:**
- Purpose: Define and organize article content
- Location: `src/content/articles/`, `src/content.config.ts`
- Contains: MDX files with frontmatter (title, date, category, tags, pillarTags, lang, translationSlug)
- Depends on: Astro Content Collections API with Zod validation
- Used by: Page generation, i18n routing

**Styling Layer:**
- Purpose: Design tokens and global styles
- Location: `src/styles/global.css`
- Contains: Tailwind v4 theme definitions, animations (fadeUp), prose styles, code block styling
- Depends on: Tailwind CSS v4 via `@tailwindcss/vite` plugin
- Used by: All HTML pages (imported in `BaseLayout.astro`)

**Configuration Layer:**
- Purpose: Build, deployment, and development setup
- Location: `astro.config.mjs`, `vitest.config.ts`, `eslint.config.js`, `prettier.config.mjs`
- Contains: Astro framework setup, test runner, linting rules, formatter settings
- Depends on: Astro 5.17.1, Cloudflare adapter, plugins (MDX, sitemap)
- Used by: Build pipeline, development server, CI/CD

## Data Flow

**Build-Time Content Resolution:**

1. Astro loads `src/content.config.ts` which defines the articles collection
2. Collection loader (`glob()`) scans `src/content/articles/` for `.md` and `.mdx` files
3. Each file's frontmatter is validated against Zod schema (title, date, category, tags, pillarTags, lang, translationSlug, series, etc.)
4. Pages in `src/pages/en/` and `src/pages/fr/` render using `getCollection('articles')` queries
5. Astro's i18n routing prefixes all URLs: `/en/articles/...` and `/fr/articles/...`
6. Final HTML is written to `dist/` and deployed to Cloudflare Pages

**Component Rendering Pipeline:**

1. Root redirect page (`src/pages/index.astro`) → `/en/` (default locale)
2. Locale pages (`src/pages/en/index.astro`, `src/pages/fr/index.astro`) → wrap content in `BaseLayout`
3. `BaseLayout` imports global styles and sets up HTML structure
4. Page-specific components render within the layout slot

**State Management:**

- No runtime state—all state is compile-time frontmatter metadata
- Locale detection: `Astro.currentLocale` in templates
- Page routing: Astro's file-based system + i18n middleware
- Article filtering/display: Static build artifacts only

## Key Abstractions

**Content Collection Schema:**
- Purpose: Enforce consistent article metadata structure
- Examples: `src/content.config.ts` defines `articles` collection
- Pattern: Zod schema validation (date coercion, enum pillarTags, optional image/series fields)
- Used by: Astro internals to validate and type-check content queries

**Layout Wrapper (BaseLayout):**
- Purpose: Provide consistent HTML structure, head metadata, font loading, intersection observer
- Examples: `src/layouts/BaseLayout.astro`
- Pattern: Astro layout component accepting title, description props; wraps page content via `<slot />`
- Used by: All pages (en/index, fr/index, article pages)

**I18n Routing:**
- Purpose: Separate content by language with URL prefixing
- Examples: `/en/articles/...`, `/fr/articles/...`
- Pattern: Astro 5 `i18n` config with `prefixDefaultLocale: true` and `redirectToDefaultLocale: true`
- Used by: All page generation, sitemap generation

**Tailwind Theme:**
- Purpose: Centralized design token management
- Examples: `src/styles/global.css` with `@theme` block
- Pattern: CSS custom properties (--color-*, --font-*) mapped to Tailwind scales
- Used by: All page and component styling via Tailwind utility classes

## Entry Points

**Root Redirect:**
- Location: `src/pages/index.astro`
- Triggers: HTTP request to `/`
- Responsibilities: Redirect to default locale (`/en/`)

**Locale Home Pages:**
- Location: `src/pages/en/index.astro`, `src/pages/fr/index.astro`
- Triggers: HTTP requests to `/en/` and `/fr/`
- Responsibilities: Display landing page with hero section, wrapped in BaseLayout

**Article Pages (Dynamic):**
- Location: `src/pages/[locale]/articles/[...slug].astro` (generated by Astro)
- Triggers: HTTP requests to `/en/articles/article-slug`, `/fr/articles/article-slug`
- Responsibilities: Fetch article from collection, render article template with metadata

## Error Handling

**Strategy:** Build-time validation via Zod schema

**Patterns:**
- Schema validation: Invalid frontmatter in articles causes build failure with clear error messages
- Missing translations: Articles must specify `lang` field; optional `translationSlug` links translated versions
- Broken links: Static output prevents runtime 404s; links are validate at build time via tools
- Type safety: TypeScript strict mode with `astro sync` (pre-flight type generation)

## Cross-Cutting Concerns

**Logging:** No application logging—Astro build logs to stdout; errors thrown during build fail with stack traces

**Validation:** Zod schema at content load time (`src/content.config.ts`); enforces required fields, enum constraints, type coercion

**Authentication:** Not applicable—static site with no authentication

**Internationalization:** Astro i18n config with `prefixDefaultLocale: true`; articles tagged with `lang` field; optional `translationSlug` for linking parallel translations

**Analytics/Tracking:** Not implemented in source code; expected to be added via client-side script (e.g., Cloudflare Analytics)

---

*Architecture analysis: 2026-02-09*
