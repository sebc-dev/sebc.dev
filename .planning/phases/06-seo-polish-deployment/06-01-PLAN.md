---
phase: 06-seo-polish-deployment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/seo/SEO.astro
  - src/components/seo/JsonLd.astro
  - src/pages/en/rss.xml.ts
  - src/pages/fr/rss.xml.ts
  - src/layouts/BaseLayout.astro
  - src/layouts/ArticleLayout.astro
  - src/pages/en/index.astro
  - src/pages/fr/index.astro
  - src/pages/en/about.astro
  - src/pages/fr/about.astro
  - src/pages/en/search.astro
  - src/pages/fr/search.astro
  - src/pages/en/articles/[id].astro
  - src/pages/fr/articles/[id].astro
autonomous: true

must_haves:
  truths:
    - "Every page has og:title, og:description, og:image, og:url, og:type meta tags"
    - "Every page has twitter:card, twitter:title, twitter:description, twitter:image meta tags"
    - "Every page has a canonical URL link and hreflang alternates for en, fr, and x-default"
    - "Article pages have JSON-LD BlogPosting structured data with headline, datePublished, author, description"
    - "RSS feeds are available at /en/rss.xml and /fr/rss.xml with valid XML"
    - "Every page has RSS autodiscovery link in the head"
  artifacts:
    - path: "src/components/seo/SEO.astro"
      provides: "Centralized OG, Twitter Card, canonical, hreflang, RSS autodiscovery meta tags"
      min_lines: 30
    - path: "src/components/seo/JsonLd.astro"
      provides: "JSON-LD BlogPosting structured data component"
      min_lines: 20
    - path: "src/pages/en/rss.xml.ts"
      provides: "English RSS feed endpoint"
      exports: ["GET"]
    - path: "src/pages/fr/rss.xml.ts"
      provides: "French RSS feed endpoint"
      exports: ["GET"]
  key_links:
    - from: "src/layouts/BaseLayout.astro"
      to: "src/components/seo/SEO.astro"
      via: "Astro component import and rendering in <head>"
      pattern: "import SEO from.*seo/SEO"
    - from: "src/layouts/ArticleLayout.astro"
      to: "src/components/seo/JsonLd.astro"
      via: "Astro component import and rendering"
      pattern: "import JsonLd from.*seo/JsonLd"
    - from: "src/pages/en/rss.xml.ts"
      to: "src/lib/articles.ts"
      via: "getArticlesByLocale and getArticleUrl imports"
      pattern: "getArticlesByLocale.*en"
    - from: "src/layouts/BaseLayout.astro"
      to: "All page files"
      via: "translationMap prop passed through for hreflang"
      pattern: "translationMap"
---

<objective>
Add complete SEO infrastructure (Open Graph, Twitter Cards, canonical/hreflang, JSON-LD) and RSS feeds to the site.

Purpose: Every page needs proper meta tags for social sharing, search engine indexing, and feed discovery. This is the core SEO layer that all pages share.
Output: SEO.astro component, JsonLd.astro component, RSS endpoints, all pages wired with translationMap props.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-seo-polish-deployment/06-RESEARCH.md
@src/layouts/BaseLayout.astro
@src/layouts/ArticleLayout.astro
@src/lib/articles.ts
@src/content.config.ts
@src/i18n/ui.ts
@src/pages/en/index.astro
@src/pages/en/about.astro
@src/pages/en/articles/[id].astro
@src/pages/en/search.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SEO and JsonLd components + RSS feed endpoints</name>
  <files>
    src/components/seo/SEO.astro
    src/components/seo/JsonLd.astro
    src/pages/en/rss.xml.ts
    src/pages/fr/rss.xml.ts
  </files>
  <action>
**1. Create `src/components/seo/SEO.astro`:**

Props interface:
```typescript
interface Props {
  title: string;
  description: string;
  image?: string;
  type?: "website" | "article";
  publishedDate?: Date;
  translationMap?: Record<string, string>;
}
```

Default `image` to `"/images/og-default.png"`, default `type` to `"website"`.

Get current lang from `Astro.currentLocale ?? "en"`. Derive `canonicalURL` from `Astro.url.pathname` combined with `Astro.site!` (this respects `trailingSlash: "never"`). Derive `ogImage` as absolute URL from `image` + `Astro.site!`.

Build hreflang alternates:
- Always include current lang pointing to canonicalURL
- If `translationMap` has the other language, include that alternate
- For `x-default`, point to the English version (or current if English not available)

Render in this order:
1. `<link rel="canonical">` with canonicalURL
2. `<link rel="alternate" hreflang="{lang}">` for each alternate + x-default
3. OG tags: `og:title`, `og:description`, `og:url`, `og:site_name` (value: "sebc.dev"), `og:type`, `og:image`, `og:locale` (use "fr_FR" or "en_US")
4. Twitter Card tags: `twitter:card` (value: "summary_large_image"), `twitter:title`, `twitter:description`, `twitter:image`
5. RSS autodiscovery: `<link rel="alternate" type="application/rss+xml" title="sebc.dev ({LANG})" href="/{lang}/rss.xml" />`

**2. Create `src/components/seo/JsonLd.astro`:**

Props interface:
```typescript
interface Props {
  headline: string;
  description: string;
  datePublished: Date;
  image?: string;
  authorName: string;
  authorUrl?: string;
  url: string;
}
```

Build a BlogPosting JSON-LD object with `@context: "https://schema.org"`, `@type: "BlogPosting"`. Include `headline`, `description`, `datePublished` (ISO string), `dateModified` (same as datePublished for now), `url`. Conditionally include `image` as array `[absoluteUrl]` if provided. Include `author` as array with `@type: "Person"`, `name`, optional `url`. Include `publisher` as `@type: "Person"` with same name. Include `mainEntityOfPage` with `@type: "WebPage"`, `@id: url`.

Render as: `<script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />`

**3. Create `src/pages/en/rss.xml.ts`:**

Install `@astrojs/rss` first: `npm install @astrojs/rss`

Export async `GET` function accepting `APIContext`. Import `rss` from `@astrojs/rss`, `getArticlesByLocale` and `getArticleUrl` from `@/lib/articles`. Get English articles, return `rss({ title: "sebc.dev", description: "Technical blog -- AI x Engineering x UX", site: context.site!, items: articles.map(...), customData: "<language>en</language>" })`. Map each article to `{ title, pubDate: article.data.date, description, link: getArticleUrl(article) }`.

**4. Create `src/pages/fr/rss.xml.ts`:**

Same as English but `getArticlesByLocale("fr")`, description: `"Blog technique -- IA x Ingenierie x UX"`, customData: `"<language>fr</language>"`.

Note: Use `--` (double dash) not `â€”` (em dash) in RSS description strings to avoid XML encoding issues.
  </action>
  <verify>
Run `npm install @astrojs/rss && npm run build` -- build succeeds with no errors. Inspect build output for rss.xml files in en/ and fr/ directories.
  </verify>
  <done>
SEO.astro renders canonical, hreflang, OG, Twitter Card, and RSS autodiscovery tags. JsonLd.astro renders BlogPosting schema. Both RSS endpoints return valid XML. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire SEO and JsonLd into layouts, pass translationMap from all pages</name>
  <files>
    src/layouts/BaseLayout.astro
    src/layouts/ArticleLayout.astro
    src/pages/en/index.astro
    src/pages/fr/index.astro
    src/pages/en/about.astro
    src/pages/fr/about.astro
    src/pages/en/search.astro
    src/pages/fr/search.astro
    src/pages/en/articles/[id].astro
    src/pages/fr/articles/[id].astro
  </files>
  <action>
**1. Update `src/layouts/BaseLayout.astro`:**

Add to Props interface: `image?: string`, `type?: "website" | "article"`, `publishedDate?: Date`. These pass through to SEO component.

Import `SEO` from `@/components/seo/SEO.astro`. Add `<SEO>` component inside `<head>`, after the existing `<meta name="description">` tag. Pass all relevant props: `title`, `description`, `image`, `type`, `publishedDate`, `translationMap`.

**2. Update `src/layouts/ArticleLayout.astro`:**

Import `JsonLd` from `@/components/seo/JsonLd.astro`. Add `<JsonLd>` component inside the BaseLayout slot (before the ReadingProgress component). Pass props: `headline={article.data.title}`, `description={article.data.description}`, `datePublished={article.data.date}`, `image={article.data.image}`, `authorName="Seb C"`, `authorUrl="https://sebc.dev"`, `url={articleUrl}`.

Also pass `image={article.data.image}`, `type="article"`, and `publishedDate={article.data.date}` to the `<BaseLayout>` component so OG tags get article-specific values.

**3. Update all page files to pass `translationMap`:**

For non-article pages (home, search, about), compute `translationMap` using path-based alternation:
```typescript
const lang = getLangFromUrl(Astro.url);
const otherLang = lang === "en" ? "fr" : "en";
const currentPath = Astro.url.pathname;
const otherPath = currentPath.replace(`/${lang}/`, `/${otherLang}/`);
// Handle root paths like /en and /fr (no trailing content after lang)
const translationMap = {
  [lang]: currentPath,
  [otherLang]: currentPath.startsWith(`/${lang}/`) ? otherPath : `/${otherLang}`,
};
```

For each page file:
- `src/pages/en/index.astro` and `src/pages/fr/index.astro`: Add translationMap computation, pass `translationMap={translationMap}` to BaseLayout. The home pages already import `getLangFromUrl` so just add the computation.
- `src/pages/en/about.astro` and `src/pages/fr/about.astro`: Same pattern. Already have `getLangFromUrl` imported.
- `src/pages/en/search.astro` and `src/pages/fr/search.astro`: Same pattern. Already have `getLangFromUrl` imported.

Note: `src/pages/en/articles/[id].astro` and `src/pages/fr/articles/[id].astro` already pass translationMap via ArticleLayout (which already computes it). No changes needed for article pages.

Important: For home pages where the URL path is `/en` or `/fr` (no trailing content), the path replace won't work with `/${lang}/` pattern. Handle this edge case: if `currentPath` equals `/${lang}`, set otherPath to `/${otherLang}`.
  </action>
  <verify>
Run `npm run build` -- build succeeds. Run `npm run typecheck` -- no type errors. Inspect a built HTML file (e.g., `dist/en/index.html`) and verify it contains `og:title`, `twitter:card`, `rel="canonical"`, `hreflang`, and `application/rss+xml` link tags.
  </verify>
  <done>
Every page has OG, Twitter Card, canonical, hreflang, and RSS autodiscovery meta tags. Article pages additionally have JSON-LD BlogPosting structured data. All translationMap props are correctly computed for path-based alternation on static pages and translationSlug-based alternation on article pages.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `npm run typecheck` passes
3. Built HTML files contain all expected meta tags (OG, Twitter Card, canonical, hreflang, RSS autodiscovery)
4. Article HTML files contain `<script type="application/ld+json">` with BlogPosting schema
5. RSS feeds at `/en/rss.xml` and `/fr/rss.xml` are valid XML with article entries
6. Hreflang links point to correct alternate language URLs
7. Canonical URLs have no trailing slashes (respecting trailingSlash: "never")
</verification>

<success_criteria>
- Every built page has og:title, og:description, og:image, og:url, og:type, twitter:card, twitter:title, twitter:description, twitter:image
- Every built page has canonical URL and hreflang alternates (en, fr, x-default)
- Every built page has RSS autodiscovery link
- Article pages have JSON-LD BlogPosting structured data
- RSS feeds exist and contain article entries
- Build and typecheck pass cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/06-seo-polish-deployment/06-01-SUMMARY.md`
</output>
