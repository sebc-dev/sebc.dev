---
phase: 06-seo-polish-deployment
plan: 03
type: execute
wave: 3
depends_on: ["06-02"]
files_modified:
  - public/images/og-default.png
  - lighthouserc.json
autonomous: false

must_haves:
  truths:
    - "Default OG image exists and is referenced correctly in SEO component"
    - "Lighthouse CI tests include an article page URL"
    - "All Lighthouse scores >= 90 for Performance, Accessibility, and SEO"
    - "Cloudflare Analytics is enabled via dashboard"
  artifacts:
    - path: "public/images/og-default.png"
      provides: "Default 1200x630 OG image for pages without specific images"
    - path: "lighthouserc.json"
      provides: "Updated Lighthouse CI config with article page URL"
      contains: "articles"
  key_links:
    - from: "src/components/seo/SEO.astro"
      to: "public/images/og-default.png"
      via: "Default image prop value"
      pattern: "/images/og-default.png"
---

<objective>
Create default OG image, update Lighthouse CI configuration, verify all Lighthouse scores pass, and set up Cloudflare Analytics checkpoint.

Purpose: Final verification that all SEO infrastructure works correctly in the build pipeline and the site is production-ready with analytics. This plan validates the work from plans 01 and 02.
Output: OG image asset, updated Lighthouse config, verified Lighthouse scores, analytics checkpoint.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-seo-polish-deployment/06-RESEARCH.md
@.planning/phases/06-seo-polish-deployment/06-01-SUMMARY.md
@.planning/phases/06-seo-polish-deployment/06-02-SUMMARY.md
@lighthouserc.json
@src/components/seo/SEO.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create default OG image + update Lighthouse CI config + run quality checks</name>
  <files>
    public/images/og-default.png
    lighthouserc.json
  </files>
  <action>
**1. Create default OG image at `public/images/og-default.png`:**

Generate a simple 1200x630 PNG image using a Node.js script (or use ImageMagick/canvas if available). The image should be:
- Background: `#0C0E14` (the canvas/void dark color from the theme)
- Text: "sebc.dev" centered in white/light text
- Accent: A teal (`#0D9488`) horizontal line or accent element
- Subtitle: "AI x Engineering x UX" below the title in lighter text

If ImageMagick (`convert` command) is available, use it:
```bash
convert -size 1200x630 xc:'#0C0E14' \
  -fill '#F0F0F5' -font 'Helvetica' -pointsize 72 -gravity center -annotate +0-40 'sebc.dev' \
  -fill '#0D9488' -pointsize 32 -annotate +0+40 'AI x Engineering x UX' \
  public/images/og-default.png
```

If ImageMagick is not available, create a minimal valid PNG programmatically or use a placeholder approach: create a simple HTML file, screenshot it, or use a canvas-based Node script. The key requirement is that a valid PNG file exists at this path. As a fallback, create a minimal 1x1 teal PNG and add a TODO comment -- but try ImageMagick first.

**2. Update `lighthouserc.json`:**

Add an article page URL to the `url` array and the about page. The current config tests `/en/`, `/fr/`, and `/en/search`. Add:
- `http://localhost:4321/en/articles/en-astro-cloudflare-setup` (or whatever the first article ID is -- check by looking at content files in `src/content/articles/`)
- `http://localhost:4321/en/about`

Look up actual article IDs from `src/content/articles/` to use a real URL. If no articles exist with predictable IDs, skip adding an article URL (the build may not have article pages to test).

**3. Run full quality validation:**

Run `npm run build` to verify the complete build pipeline works. Then run `npm run lint`, `npm run typecheck`, and `npm run test` to catch any regressions.

Inspect the built output to verify:
- `dist/en/index.html` contains OG tags, hreflang, canonical
- `dist/en/rss.xml` exists and is valid XML
- `dist/fr/rss.xml` exists and is valid XML
- An article page HTML (if exists) contains JSON-LD structured data
  </action>
  <verify>
Run `npm run build && npm run lint && npm run typecheck && npm run test`. All pass. Verify `public/images/og-default.png` exists and is a valid image file. Verify `lighthouserc.json` has the updated URL list.
  </verify>
  <done>
Default OG image exists at `public/images/og-default.png`. Lighthouse CI config includes article and about page URLs. Build, lint, typecheck, and tests all pass. Built HTML files contain all expected SEO meta tags.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify View Transitions and Cloudflare Analytics setup</name>
  <what-built>
Complete SEO infrastructure (OG tags, Twitter Cards, canonical/hreflang, JSON-LD, RSS feeds), View Transitions with ClientRouter, and script migration for all 11 interactive scripts.
  </what-built>
  <how-to-verify>
1. **View Transitions:** Run `npm run preview` and navigate between pages. Verify smooth fade transitions occur between Home, Search, About, and Article pages. Verify no flash of unstyled content.

2. **Script functionality after navigation:**
   - From Home, click an article -> verify TOC scroll spy works, reading progress bar tracks scroll, code blocks have language labels, share copy link works
   - Navigate back to Home -> verify category filter buttons still toggle
   - Navigate to Search -> verify search input works and filters apply
   - Navigate to About -> verify scroll reveal animations fire

3. **SEO meta tags:** Right-click > View Page Source on any page. Verify:
   - `<link rel="canonical">` present with correct URL
   - `<link rel="alternate" hreflang="en">` and `hreflang="fr"` present
   - `<meta property="og:title">`, `og:description`, `og:image`, `og:url` present
   - `<meta name="twitter:card" content="summary_large_image">` present
   - `<link rel="alternate" type="application/rss+xml">` present

4. **JSON-LD on article page:** View source on an article page. Verify `<script type="application/ld+json">` contains BlogPosting schema.

5. **RSS feeds:** Visit `/en/rss.xml` and `/fr/rss.xml` in browser. Verify valid RSS XML with article entries.

6. **Cloudflare Analytics:** Go to the Cloudflare Dashboard > Your site > Web Analytics. Enable "Web Analytics" if not already enabled. This auto-injects the analytics beacon script on all pages. No code changes needed. Confirm the toggle is ON.
  </how-to-verify>
  <resume-signal>Type "approved" to confirm everything works, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
1. Default OG image exists and is valid
2. Lighthouse CI config includes article + about page URLs
3. All quality checks pass (build, lint, typecheck, test)
4. View Transitions provide smooth page navigation
5. All interactive scripts work after client-side navigation
6. SEO meta tags present on every page
7. RSS feeds are accessible and valid
8. Cloudflare Analytics enabled via dashboard
</verification>

<success_criteria>
- `public/images/og-default.png` exists as a valid 1200x630 PNG
- `lighthouserc.json` tests home, search, about, and at least one article page
- `npm run build && npm run lint && npm run typecheck && npm run test` all pass
- User confirms View Transitions work correctly
- User confirms Cloudflare Analytics is enabled in dashboard
- All interactive features survive client-side navigation
</success_criteria>

<output>
After completion, create `.planning/phases/06-seo-polish-deployment/06-03-SUMMARY.md`
</output>
