---
import {
  getLangFromUrl,
  useTranslations,
  getCategoryLabel,
} from "@/i18n/utils";
import type { Category } from "@/lib/categories";

interface Props {
  categories: Category[];
}

const { categories } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<section
  class="pt-10 pb-6 fade-up fade-up-d1"
  aria-label={t("search.categories")}
>
  <div class="flex flex-wrap items-center gap-2.5">
    <button
      data-filter="all"
      class="text-sm font-medium px-3.5 py-1.5 rounded-xs border whitespace-nowrap transition-all hover:border-teal/40 hover:text-teal-bright text-teal-bright border-teal bg-teal-dim"
      aria-pressed="true"
    >
      {t("home.filterAll")}
    </button>
    {
      categories.map((category) => (
        <button
          data-filter={category}
          class="text-sm font-medium px-3.5 py-1.5 rounded-xs border border-border text-text-muted whitespace-nowrap transition-all hover:border-teal/40 hover:text-teal-bright"
          aria-pressed="false"
        >
          {getCategoryLabel(category, lang)}
        </button>
      ))
    }
  </div>
</section>

<script>
  document.addEventListener("astro:page-load", () => {
    const buttons = document.querySelectorAll("[data-filter]");
    const cards = document.querySelectorAll("[data-category]");

    buttons.forEach((button) => {
      button.addEventListener("click", () => {
        const filter = (button as HTMLElement).dataset.filter;

        // Update active state on all buttons
        buttons.forEach((btn) => {
          if (btn === button) {
            btn.classList.add("text-teal-bright", "border-teal", "bg-teal-dim");
            btn.classList.remove("text-text-muted", "border-border");
            btn.setAttribute("aria-pressed", "true");
          } else {
            btn.classList.remove(
              "text-teal-bright",
              "border-teal",
              "bg-teal-dim",
            );
            btn.classList.add("text-text-muted", "border-border");
            btn.setAttribute("aria-pressed", "false");
          }
        });

        // Show/hide cards
        cards.forEach((card) => {
          const category = (card as HTMLElement).dataset.category;
          if (filter === "all" || category === filter) {
            card.classList.remove("hidden");
          } else {
            card.classList.add("hidden");
          }
        });

        // Notify pagination to reset
        document.dispatchEvent(new CustomEvent("category-filter-change"));
      });
    });
  });
</script>
