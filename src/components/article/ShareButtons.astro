---
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
import {
  buildTwitterShareUrl,
  buildLinkedInShareUrl,
  buildDevToShareUrl,
} from "@/lib/shareUrls";

interface Props {
  url: string;
  title: string;
}

const { url, title } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const twitterUrl = buildTwitterShareUrl(title, url);
const linkedinUrl = buildLinkedInShareUrl(title, url);
const devtoUrl = buildDevToShareUrl(title, url);
---

<div>
  <h3
    class="text-xs font-semibold uppercase tracking-widest text-text-muted mb-4"
  >
    {t("article.share")}
  </h3>
  <div class="flex gap-2">
    <!-- Twitter/X -->
    <a
      href={twitterUrl}
      target="_blank"
      rel="noopener noreferrer"
      class="w-9 h-9 flex items-center justify-center rounded-xs border border-border text-text-muted hover:text-teal hover:border-teal/30 transition-colors"
      aria-label={t("article.shareTwitter")}
    >
      <svg
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path
          d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"
        ></path>
      </svg>
    </a>

    <!-- LinkedIn -->
    <a
      href={linkedinUrl}
      target="_blank"
      rel="noopener noreferrer"
      class="w-9 h-9 flex items-center justify-center rounded-xs border border-border text-text-muted hover:text-teal hover:border-teal/30 transition-colors"
      aria-label={t("article.shareLinkedin")}
    >
      <svg
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path
          d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"
        ></path>
        <rect width="4" height="12" x="2" y="9"></rect>
        <circle cx="4" cy="4" r="2"></circle>
      </svg>
    </a>

    <!-- dev.to -->
    <a
      href={devtoUrl}
      target="_blank"
      rel="noopener noreferrer"
      class="w-9 h-9 flex items-center justify-center rounded-xs border border-border text-text-muted hover:text-teal hover:border-teal/30 transition-colors"
      aria-label={t("article.shareDevto")}
    >
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path
          d="M7.42 10.05c-.18-.16-.46-.23-.84-.23H6l.02 2.44.04 2.45.56-.02c.41 0 .63-.07.83-.26.24-.24.26-.36.26-2.2 0-1.91-.02-1.96-.29-2.18zM0 4.94v14.12h24V4.94H0zM8.56 15.3c-.44.58-1.06.77-2.53.77H4.71V8.53h1.4c1.67 0 2.16.18 2.6.9.27.43.29.6.32 2.57.05 2.23-.02 2.73-.47 3.3zm5.09-5.47h-2.47v1.77h1.52v1.28l-.72.04-.75.03v1.77l1.22.03 1.2.04v1.28h-1.6c-1.53 0-1.6-.01-1.87-.3l-.3-.28v-3.16c0-3.02.01-3.18.25-3.48.23-.31.25-.31 1.88-.31h1.64v1.3zm4.68 5.45c-.17.43-.64.79-1 .79-.18 0-.45-.15-.67-.39-.32-.32-.45-.63-.82-2.08l-.9-3.39-.45-1.67h.76c.4 0 .75.02.75.05 0 .06 1.16 4.54 1.26 4.83.04.15.32-.7.73-2.3l.66-2.52.74-.04c.4-.02.73 0 .73.04 0 .14-1.67 6.38-1.8 6.68z"
        ></path>
      </svg>
    </a>

    <!-- Copy link -->
    <button
      data-copy-url={url}
      class="w-9 h-9 flex items-center justify-center rounded-xs border border-border text-text-muted hover:text-teal hover:border-teal/30 transition-colors"
      aria-label={t("article.copyLink")}
    >
      <svg
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"
        ></path>
        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"
        ></path>
      </svg>
    </button>
  </div>
</div>

<script>
  function initCopyLink() {
    const buttons = document.querySelectorAll(
      "[data-copy-url]",
    ) as NodeListOf<HTMLButtonElement>;

    buttons.forEach((button) => {
      button.addEventListener("click", async () => {
        const url = button.getAttribute("data-copy-url");
        if (!url) return;

        try {
          await navigator.clipboard.writeText(url);

          // Visual feedback
          const originalLabel = button.getAttribute("aria-label") || "";
          button.setAttribute(
            "aria-label",
            button.getAttribute("aria-label-copied") || "Copied!",
          );
          button.classList.add("text-teal", "border-teal/30");

          setTimeout(() => {
            button.setAttribute("aria-label", originalLabel);
            button.classList.remove("text-teal", "border-teal/30");
          }, 2000);
        } catch (error) {
          console.error("Failed to copy URL:", error);
        }
      });
    });
  }

  initCopyLink();
  document.addEventListener("astro:after-swap", initCopyLink);
</script>
